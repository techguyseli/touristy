{% extends "service/layout/layout.html" %}

{% block title %}{{ page_title }}{% endblock %}

{% block body %}
{% if msg %}
<div class="alert alert-warning" role="alert">
  {{ msg }}
</div>
{% endif %}
  {% if not service %}
      <div class="alert alert-warning" role="alert">
          No such service.
      </div>

  {% else %}
    <div class="container">
      {% if images %}
        <div class="Album my-5 mx-auto w-25">
            <div id="carouselExampleControls" class="carousel slide carousel-dark">
              <div class="carousel-inner">

                {% for image in images %}
                  <div class="carousel-item">
                    <img src="{{ image.url }}" class="d-block w-100">
                  </div>
                {% endfor %}

              </div>
              <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
              </button>
            </div>
        </div>
      {% else %}
        <h1>No images available</h1>
      {% endif %}

      <div class="border rounded p-3 my-5"> 
          <h1>{{ service.title }}</h1>
          <h5 class="mb-4">{{ service.type | title }}</h5>

          {% if request.user.is_authenticated %}
            <div class="mb-4">
              {% if favourited %}
                <button type="button" class="btn btn-primary">Remove from favorites</button>
              {% else %}
                <form action="{% url 'add_favourite' %}" method="post" class="my-1">
                  {% csrf_token %}
                  <input type="hidden" name="service_id" value="{{ service.id }}">
                  <input type="submit" class="btn btn-primary" value="Add to favourites">
                </form>
              {% endif %}

              {% if userOwnsService %}
              <form action="{% url 'edit_service' %}" method="post" class="my-1">
                {% csrf_token %}
                <input type="hidden" value="{{ service.id }}">
                <input type="submit" class="btn btn-primary" value="Edit">
              </form>
              {% endif %}
            </div>

            {% if not service_rated %}
              <hr>
              <h1>Rate this service</h1>
              <form action="{% url 'add_rating' %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="service_id" value="{{ service.id }}">
                <input name="stars" type="range" class="form-range w-25" min="1" max="5" id="customRange2">
                <div class="form-floating mb-4">
                  <textarea name="comment" class="form-control" placeholder="Leave a comment here" id="floatingTextarea2" style="height: 100px"></textarea>
                  <label for="floatingTextarea2">Comment</label>
                </div>
                <div class="d-grid gap-2 d-md-block">
                  <input type="submit" class="btn btn-primary" value="Post">
                </div>
              </form>
            {% endif %}
          {% endif %}
          <hr>
          {% if ratings %}
            <h1>Ratings</h1>
            {% for rating in ratings %}
              <div class="border rounded m-2 p-2">
                <h3>{{ rating.user.username }}</h3>
                <div class="progress m-3">
                  <div class="progress-bar" role="progressbar" style="width: {{ rating.percentage }}%" aria-valuenow="{{ rating.percentage }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>                
                <textarea class="form-control" id="floatingTextarea2" style="height: 100px" disabled>{{ rating.comment_str }}</textarea>
                {% if rating.userRating %}
                  <form action="{% url 'remove_rating' %}" method="post" class="my-2">
                    {% csrf_token %}
                    <input type="hidden" name="service_id" value="{{ service.id }}">
                    <input type="hidden" name="rating_id" value="{{ rating.id }}">
                    <input type="submit" class="btn btn-primary" value="Delete">
                  </form>
                {% endif %}
              </div>
            {% endfor %}
          {% else %}
            <h1>This service is not rated yet.</h1>
          {% endif %}
      </div>
    </div>    
  {% endif %}

  <script>
    window.addEventListener('load', 
      function() { 
        images = document.querySelectorAll(".carousel-item");
        console.log(images)
        images[0].classList.add("active");
      }, false);
  </script>
{% endblock %}